geometry :
  nemo variables:
    - name: depth
      nemo field name: nav_lev
      model space: vertical
    - name: sea_water_potential_temperature
      nemo field name: votemper
      model space: volume
    - name: sea_water_potential_temperature_background_error
      nemo field name: t_tot_var
      model space: volume
      variable type: background variance
    - name: sea_water_salinity
      nemo field name: vosaline
      model space: volume
    - name: sea_water_salinity_background_error
      nemo field name: t_tot_var
      model space: volume
      variable type: background variance
  grid name: ORCA2_T
  number levels: 3
state :
  date: 2021-06-30T00:00:00Z
  state variables:
  - sea_water_potential_temperature
  - sea_water_potential_temperature_background_error
  - depth
  - sea_water_salinity
  - sea_water_salinity_background_error
  nemo field file: ../../../orca-jedi/src/tests/Data/orca2_t_nemo.nc
  variance field file: ../../../orca-jedi/src/tests/Data/orca2_t_bkg_var.nc
window begin: 2021-06-29T12:00:00Z
window length: P1D
observations:
  observers:
  - obs space:
      name: Sea Temperature
      obsdatain:
        engine:
          type: H5File
          obsfile: Data/hofx_prof_2var_obs.nc
        obsgrouping:
          group variables: ["station_id", "dateTime"]
          sort variable: depth
          sort group: ObsValue
          sort order: descending
      obsdataout:
        engine:
          type: H5File
          obsfile: testoutput/test_hofx3d_profiles_2var_writer_jopa_out.nc
      simulated variables: [sea_water_potential_temperature, sea_water_salinity]
    get values:
      atlas-interpolator:
        type: unstructured-bilinear-lonlat
        non_linear: missing-if-all-missing
    obs operator:
      name: VertInterp
      variables:
      - name: sea_water_potential_temperature
      - name: sea_water_salinity
      vertical coordinate: depth
      observation vertical coordinate group: ObsValue
    obs filters:
#    - filter: Create Diagnostic Flags
#      flags:
#      - name: FinalReject
#        initial value: false
#    - filter: RejectList
#      defer to post: true
#      where:
#      - variable:
#          name: sea_water_potential_temperature@ObsValue
#        is_not_defined:
#      actions:
#      - name: set
#        flag: FinalReject
#      - name: reject
#    - filter: RejectList
#      defer to post: true
#      where:
#      - variable:
#          name: sea_water_potential_temperature@HofX
#        is_not_defined:
#      actions:
#      - name: set
#        flag: FinalReject
#      - name: reject
#    - filter: GOMsaver
#      filename: test_hofx3d_prof_2var_jopa_out_geovals.nc
    - filter: Variable Assignment
      assignments:
      - name: sea_water_potential_temperature@QCFlags
        type: int
        value: 1
      - name: sea_water_salinity@QCFlags
        type: int
        value: 1
    - filter: NEMO Feedback Writer
      filename: testoutput/test_hofx3d_nc_prof_2vars_writer_out.nc
      reference date: 1950-01-01T00:00:00Z
      variables:
      - name: sea_water_potential_temperature
        nemo name: POTM
        long name: sea water potential temperature
        units: degrees Celsius
        additional variables:
        - name: sea_water_potential_temperature
          feedback suffix: Hx
          ioda group: HofX
      - name: sea_water_salinity
        nemo name: PSAL
        long name: sea water salinity
        units: degrees Celsius
        additional variables:
        - name: sea_water_salinity
          feedback suffix: Hx
          ioda group: HofX
    - filter: GOMsaver
      filename: testoutput/test_hofx3d_nc_prof_2vars_writer_geovals.nc
test:
  reference filename: testoutput/test_hofx3d_nc_prof_2vars_writer.ref
